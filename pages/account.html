<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Личный кабинет - SvetSalonPro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="../images/logo.png">
    <link rel="shortcut icon" type="image/png" href="../images/logo.png">
    <script>
        // Глобальная переменная для Supabase
        let supabaseClient = null;
        
        // Функция загрузки Supabase SDK
        function loadSupabase() {
            return new Promise((resolve, reject) => {
                // Пробуем загрузить с unpkg
                const script1 = document.createElement('script');
                script1.src = 'https://unpkg.com/@supabase/supabase-js@2';
                script1.onload = () => {
                    console.log('Supabase SDK загружен с unpkg');
                    // Ждем немного, чтобы SDK полностью инициализировался
                    setTimeout(() => {
                        if (typeof window.supabase !== 'undefined') {
                            console.log('Supabase SDK готов к использованию в window.supabase');
                            resolve();
                        } else if (typeof supabase !== 'undefined') {
                            console.log('Supabase SDK готов к использованию в глобальной переменной');
                            // Делаем доступным в window
                            window.supabase = supabase;
                            resolve();
                        } else {
                            reject(new Error('Supabase SDK загружен, но не инициализирован'));
                        }
                    }, 200);
                };
                script1.onerror = () => {
                    console.log('Ошибка загрузки с unpkg, пробуем cdn.jsdelivr.net');
                    
                    // Пробуем альтернативный источник
                    const script2 = document.createElement('script');
                    script2.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
                    script2.onload = () => {
                        console.log('Supabase SDK загружен с cdn.jsdelivr.net');
                        setTimeout(() => {
                            if (typeof window.supabase !== 'undefined') {
                                console.log('Supabase SDK готов к использованию в window.supabase');
                                resolve();
                            } else if (typeof supabase !== 'undefined') {
                                console.log('Supabase SDK готов к использованию в глобальной переменной');
                                window.supabase = supabase;
                                resolve();
                            } else {
                                reject(new Error('Supabase SDK загружен, но не инициализирован'));
                            }
                        }, 200);
                    };
                    script2.onerror = () => {
                        reject(new Error('Не удалось загрузить Supabase SDK'));
                    };
                    document.head.appendChild(script2);
                };
                document.head.appendChild(script1);
            });
        }
        
        // Загружаем SDK при загрузке страницы
        window.addEventListener('load', async function() {
            try {
                await loadSupabase();
                console.log('Supabase SDK загружен успешно!');
                // Запускаем инициализацию
                if (typeof initSupabase === 'function') {
                    initSupabase();
                }
            } catch (error) {
                console.error('Ошибка загрузки Supabase:', error);
                showNotification('error', 'Ошибка загрузки', error.message);
            }
        });
    </script>
    <script src="../supabase-config.js"></script>
    <style>

        
        .nav-link:hover::after {
            content: '';
            display: block;
            width: 100%;
            height: 2px;
            background-color: #ec4899;
            margin-top: 2px;
        }

        /* Анимации для карточек услуг */
        .service-card {
            transition: all 0.3s ease;
            transform: translateY(0);
            position: relative;
        }
        
        .service-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(236, 72, 153, 0.1), 0 10px 10px -5px rgba(236, 72, 153, 0.04);
        }
        
        .service-card img {
            transition: transform 0.3s ease;
        }
        
        .service-card:hover img {
            transform: scale(1.05);
        }
        
        .service-card.selected {
            background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
            border: 2px solid #ec4899;
            box-shadow: 0 10px 25px rgba(236, 72, 153, 0.2);
            transform: translateY(-4px);
        }
        
        .service-card.selected::before {
            content: '✓';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ec4899;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }

        /* Custom Notification Styles */
        .notification {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            padding: 16px 20px;
            margin-bottom: 8px;
            max-width: 400px;
            border-left: 4px solid;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .notification.success {
            border-left-color: #10b981;
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
        }
        
        .notification.error {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #fef2f2 100%);
        }
        
        .notification.warning {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
        }
        
        .notification.info {
            border-left-color: #3b82f6;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }
        
        .notification-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .notification.success .notification-icon {
            background: #10b981;
            color: white;
        }
        
        .notification.error .notification-icon {
            background: #ef4444;
            color: white;
        }
        
        .notification.warning .notification-icon {
            background: #f59e0b;
            color: white;
        }
        
        .notification.info .notification-icon {
            background: #3b82f6;
            color: white;
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: #1f2937;
        }
        
        .notification-message {
            color: #6b7280;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: color 0.2s;
        }
        
        .notification-close:hover {
            color: #6b7280;
        }

        .form-input:focus {
            border-color: #ec4899;
            box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
        }
        
        /* Улучшенные стили для полей ввода */
        .form-input {
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            background-color: #ffffff;
        }
        
        .form-input:hover {
            border-color: #9ca3af;
        }
        
        /* Специальные стили для полей даты и времени */
        input[type="date"], input[type="time"], select {
            padding: 0.625rem 0.875rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            background-color: #ffffff;
            transition: all 0.2s ease;
        }
        
        input[type="date"]:focus, input[type="time"]:focus, select:focus {
            border-color: #ec4899;
            box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
            outline: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px 0 rgba(236,72,153,0.3);
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(236, 72, 153, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px 0 rgba(236,72,153,0.15);
        }

        .auth-form {
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(251, 207, 232, 0.1) 100%);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="font-sans bg-gradient-to-br from-pink-50 to-white text-gray-800 min-h-screen">
    <!-- Custom Notification System -->
    <div id="notificationContainer" class="fixed top-20 left-4 right-4 z-50 space-y-2 max-w-sm mx-auto"></div>
    <!-- Header -->
    <header class="fixed w-full bg-white shadow-sm z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center">
                <a href="../index.html" class="logo-link">
                    <h1 class="text-2xl font-bold text-pink-600 hover:text-pink-700 transition-colors duration-200 cursor-pointer">SvetSalonPro</h1>
                </a>
            </div>
            <nav class="hidden md:flex space-x-8">
                <a href="../index.html#home" class="nav-link text-gray-700 hover:text-pink-600 transition">Главная</a>
                <a href="../index.html#about" class="nav-link text-gray-700 hover:text-pink-600 transition">О нас</a>
                <a href="../index.html#services" class="nav-link text-gray-700 hover:text-pink-600 transition">Услуги</a>
                <a href="../index.html#masters" class="nav-link text-gray-700 hover:text-pink-600 transition">Мастера</a>
                <a href="../index.html#contact" class="nav-link text-gray-700 hover:text-pink-600 transition">Контакты</a>
                <a href="account.html" class="nav-link text-pink-600 font-semibold">Личный кабинет</a>
            </nav>
            <button id="mobileMenuBtn" class="md:hidden text-gray-700">
                <i class="fas fa-bars text-2xl"></i>
            </button>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="md:hidden hidden bg-white border-t border-gray-200">
            <div class="px-4 py-6 space-y-4">
                <a href="../index.html#home" class="block text-gray-700 hover:text-pink-600 transition py-2">Главная</a>
                <a href="../index.html#about" class="block text-gray-700 hover:text-pink-600 transition py-2">О нас</a>
                <a href="../index.html#services" class="block text-gray-700 hover:text-pink-600 transition py-2">Услуги</a>
                <a href="../index.html#masters" class="block text-gray-700 hover:text-pink-600 transition py-2">Мастера</a>
                <a href="../index.html#contact" class="block text-gray-700 hover:text-pink-600 transition py-2">Контакты</a>
                <a href="account.html" class="block text-pink-600 font-semibold py-2">Личный кабинет</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-32 pb-20">
        <div class="container mx-auto px-4">
            <!-- Auth Section -->
            <div id="authSection" class="max-w-md mx-auto mb-8 fade-in">
                <div class="card rounded-xl p-8 text-center">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">Вход в личный кабинет</h2>
                    
                    <!-- Login Form -->
                    <form id="loginForm" class="space-y-4">
                        <div>
                            <label for="email" class="block text-gray-700 font-medium mb-2 text-left">Email</label>
                            <input type="email" id="email" name="email" required 
                                   class="form-input w-full"
                                   placeholder="your@email.com">
                        </div>
                        
                        <button type="submit" id="loginBtn" class="btn-primary w-full py-3 px-6 rounded-lg text-white font-semibold">
                            <span id="loginBtnText">Войти</span>
                            <span id="loginBtnLoading" class="loading hidden"></span>
                        </button>
                    </form>
                    
                    <div class="mt-6 text-sm text-gray-600">
                        <p>Мы отправим ссылку для входа на ваш email</p>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profileSection" class="hidden max-w-4xl mx-auto fade-in">
                <div class="grid md:grid-cols-3 gap-8">
                    <!-- Profile Info -->
                    <div class="md:col-span-1">
                        <div class="card rounded-xl p-6">
                            <div class="text-center mb-6">
                                <div class="w-24 h-24 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4 overflow-hidden">
                                    <i class="fas fa-user text-3xl text-pink-600" id="mainProfileIcon"></i>
                                    <img id="mainProfileImage" class="w-full h-full object-cover hidden" alt="Фото профиля">
                                </div>
                                <h3 id="userName" class="text-xl font-semibold text-gray-800">Загрузка...</h3>
                                <p id="userEmail" class="text-gray-600">loading@email.com</p>
                                <p id="userPhone" class="text-gray-600">+7 (___) ___-__-__</p>
                            </div>
                            
                            <button id="editProfileBtn" class="w-full py-2 px-4 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition mb-3">
                                Редактировать профиль
                            </button>
                            <button id="logoutBtn" class="w-full py-2 px-4 border border-pink-300 text-pink-600 rounded-lg hover:bg-pink-50 transition">
                                Выйти
                            </button>
                        </div>
                    </div>

                    <!-- Bookings -->
                    <div class="md:col-span-2">
                        <div class="card rounded-xl p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-semibold text-gray-800">Мои записи</h3>
                                <button id="newBookingBtn" class="btn-primary py-2 px-4 rounded-lg text-white font-semibold">
                                    Новая запись
                                </button>
                            </div>
                            
                            <div id="bookingsList" class="space-y-4">
                                <!-- Bookings will be loaded here -->
                            </div>
                            
                            <div id="noBookings" class="hidden text-center py-12">
                                <i class="fas fa-calendar-times text-4xl text-gray-300 mb-4"></i>
                                <p class="text-gray-500">У вас пока нет записей</p>
                                <button id="bookFirstBtn" class="btn-primary mt-4 py-2 px-6 rounded-lg text-white font-semibold">
                                    Записаться на услугу
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Booking Modal -->
            <div id="bookingModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-semibold text-gray-800">Выберите услугу для записи</h3>
                            <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <!-- Services Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                            <!-- SPA процедуры -->
                            <div class="service-card bg-white rounded-lg shadow-md p-6 cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-2" data-service="spa" data-price="800">
                                <div class="text-center">
                                    <img src="../images/SPA процедуры.JPG" alt="SPA процедуры" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4">
                                    <h4 class="text-lg font-semibold mb-2">SPA процедуры</h4>
                                    <p class="text-pink-600 font-bold mb-2">от 800 ₽</p>
                                    <p class="text-gray-600 text-sm">Расслабляющие и оздоравливающие процедуры для волос и кожи головы.</p>
                                </div>
                            </div>
                            
                            <!-- Женская стрижка -->
                            <div class="service-card bg-white rounded-lg shadow-md p-6 cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-2" data-service="womens_haircut" data-price="700">
                                <div class="text-center">
                                    <img src="../images/Женская стрижка.JPG" alt="Женская стрижка" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Женская стрижка</h4>
                                    <p class="text-pink-600 font-bold mb-2">от 700 ₽</p>
                                    <p class="text-gray-600 text-sm">Современные женские стрижки любой сложности с учетом ваших пожеланий.</p>
                                </div>
                            </div>
                            
                            <!-- Мужская стрижка -->
                            <div class="service-card bg-white rounded-lg shadow-md p-6 cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-2" data-service="mens_haircut" data-price="700">
                                <div class="text-center">
                                    <img src="../images/Мужская стрижка.JPG" alt="Мужская стрижка" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Мужская стрижка</h4>
                                    <p class="text-pink-600 font-bold mb-2">от 700 ₽</p>
                                    <p class="text-gray-600 text-sm">Классические и современные мужские стрижки для любого стиля.</p>
                                </div>
                            </div>
                            
                            <!-- Мужская стрижка под машинку -->
                            <div class="service-card bg-white rounded-lg shadow-md p-6 cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-2" data-service="mens_machine" data-price="600">
                                <div class="text-center">
                                    <img src="../images/Мужская стрижка под машинку.JPG" alt="Мужская стрижка под машинку" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Мужская стрижка под машинку</h4>
                                    <p class="text-pink-600 font-bold mb-2">от 600 ₽</p>
                                    <p class="text-gray-600 text-sm">Быстрая и аккуратная стрижка под машинку для мужчин и детей.</p>
                                </div>
                            </div>
                            
                            <!-- Окрашивание волос -->
                            <div class="service-card bg-white rounded-lg shadow-md p-6 cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-2" data-service="coloring" data-price="800">
                                <div class="text-center">
                                    <img src="../images/Окрашивание волос.JPG" alt="Окрашивание волос" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Окрашивание волос</h4>
                                    <p class="text-pink-600 font-bold mb-2">от 800 ₽</p>
                                    <p class="text-gray-600 text-sm">Профессиональное окрашивание с использованием премиальных красок.</p>
                                </div>
                            </div>
                            
                            <!-- Мелирование волос -->
                            <div class="service-card bg-white rounded-lg shadow-md p-6 cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-2" data-service="highlighting" data-price="1200">
                                <div class="text-center">
                                    <img src="../images/Мелирование волос.JPG" alt="Мелирование волос" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Мелирование волос</h4>
                                    <p class="text-pink-600 font-bold mb-2">1200 ₽</p>
                                    <p class="text-gray-600 text-sm">Мелирование для создания ярких и естественных акцентов в прическе.</p>
                                </div>
                            </div>
                            
                            <!-- Ламинирование волос -->
                            <div class="service-card bg-white rounded-lg shadow-md p-6 cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-2" data-service="lamination" data-price="1000">
                                <div class="text-center">
                                    <img src="../images/Ламинирования волос.JPG" alt="Ламинирование волос" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Ламинирование волос</h4>
                                    <p class="text-pink-600 font-bold mb-2">1000 ₽</p>
                                    <p class="text-gray-600 text-sm">Процедура для гладкости, блеска и защиты волос от повреждений.</p>
                                </div>
                            </div>
                            
                            <!-- Колористика волос -->
                            <div class="service-card bg-white rounded-lg shadow-md p-6 cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-2" data-service="coloristics" data-price="2800">
                                <div class="text-center">
                                    <img src="../images/Колористика волос.JPG" alt="Колористика волос" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Колористика волос</h4>
                                    <p class="text-pink-600 font-bold mb-2">от 2800 ₽</p>
                                    <p class="text-gray-600 text-sm">Сложные техники окрашивания и подбор идеального оттенка.</p>
                                </div>
                            </div>
                            
                            <!-- Укрепление гелем -->
                            <div class="service-card bg-white rounded-lg shadow-md p-6 cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-2" data-service="gel" data-price="1300">
                                <div class="text-center">
                                    <img src="../images/Укрепление гелем 00.37.43.JPG" alt="Укрепление гелем" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Укрепление гелем</h4>
                                    <p class="text-pink-600 font-bold mb-2">1300 ₽</p>
                                    <p class="text-gray-600 text-sm">Укрепление и восстановление структуры ногтей с помощью геля.</p>
                                </div>
                            </div>
                            
                            <!-- Комбинированный маникюр -->
                            <div class="service-card bg-white rounded-lg shadow-md p-6 cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-2" data-service="combined_manicure" data-price="1500">
                                <div class="text-center">
                                    <img src="../images/Комбинированный маникюр.jpg" alt="Комбинированный маникюр" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Комбинированный маникюр</h4>
                                    <p class="text-pink-600 font-bold mb-2">1500 ₽</p>
                                    <p class="text-gray-600 text-sm">Комбинированный маникюр с укреплением ногтевой пластины.</p>
                                </div>
                            </div>
                            
                            <!-- Классический маникюр -->
                            <div class="service-card bg-white rounded-lg shadow-md p-6 cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-2" data-service="classic_manicure" data-price="700">
                                <div class="text-center">
                                    <img src="../images/Классический маникюр.png" alt="Классический маникюр" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Классический маникюр</h4>
                                    <p class="text-pink-600 font-bold mb-2">700 ₽</p>
                                    <p class="text-gray-600 text-sm">Классический маникюр с использованием профессиональных средств.</p>
                                </div>
                            </div>
                            
                            <!-- Ремонт одного ногтя -->
                            <div class="service-card bg-white rounded-lg shadow-md p-6 cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-2" data-service="nail_repair" data-price="300">
                                <div class="text-center">
                                    <img src="../images/Ремонт одного ногтя.jpg" alt="Ремонт одного ногтя" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Ремонт одного ногтя</h4>
                                    <p class="text-pink-600 font-bold mb-2">300 ₽</p>
                                    <p class="text-gray-600 text-sm">Профессиональный ремонт поврежденного ногтя.</p>
                                </div>
                            </div>
                            
                            <!-- Укрепление базой или биогелем -->
                            <div class="service-card bg-white rounded-lg shadow-md p-6 cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-2" data-service="base_strengthening" data-price="800">
                                <div class="text-center">
                                    <img src="../images/Укрепление_базой_или_биогелем_копия.jpeg" alt="Укрепление базой или биогелем" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Укрепление базой или биогелем</h4>
                                    <p class="text-pink-600 font-bold mb-2">800 ₽</p>
                                    <p class="text-gray-600 text-sm">Укрепление ногтей базой или биогелем для прочности.</p>
                                </div>
                            </div>
                            
                            <!-- Снятие покрытия -->
                            <div class="service-card bg-white rounded-lg shadow-md p-6 cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-2" data-service="coating_removal" data-price="400">
                                <div class="text-center">
                                    <img src="../images/Снятие покрытия.jpeg" alt="Снятие покрытия" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Снятие покрытия</h4>
                                    <p class="text-pink-600 font-bold mb-2">400 ₽</p>
                                    <p class="text-gray-600 text-sm">Безопасное снятие гель-лака и других покрытий.</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Booking Form (hidden initially) -->
                        <div id="bookingFormContainer" class="hidden">
                            <div class="border-t pt-6">
                                <h4 class="text-lg font-semibold mb-4">Запись на <span id="selectedServiceName"></span></h4>
                                <form id="newBookingForm" class="space-y-4">
                                    <input type="hidden" id="selectedService" name="service">
                                    <input type="hidden" id="selectedServicePrice" name="price">
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label for="dateSelect" class="block text-gray-700 font-medium mb-2">Дата</label>
                                            <input type="date" id="dateSelect" name="date" required class="form-input w-full">
                                        </div>
                                        
                                        <div>
                                            <label for="timeSelect" class="block text-gray-700 font-medium mb-2">Время</label>
                                            <select id="timeSelect" name="time" required class="form-input w-full">
                                                <option value="">Выберите время</option>
                                                <option value="11:00">11:00</option>
                                                <option value="12:00">12:00</option>
                                                <option value="13:00">13:00</option>
                                                <option value="14:00">14:00</option>
                                                <option value="15:00">15:00</option>
                                                <option value="16:00">16:00</option>
                                                <option value="17:00">17:00</option>
                                                <option value="18:00">18:00</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="flex space-x-3 pt-4">
                                        <button type="button" id="backToServicesBtn" class="flex-1 py-2 px-4 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                                            Назад к услугам
                                        </button>
                                        <button type="submit" class="flex-1 btn-primary py-2 px-4 rounded-lg text-white font-semibold">
                                            Записаться
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">Редактировать профиль</h3>
                    <button id="closeEditModalBtn" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="editProfileForm" class="space-y-4">
                    <div class="text-center mb-6">
                        <div class="relative inline-block">
                            <div id="profileImagePreview" class="w-24 h-24 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4 overflow-hidden">
                                <i class="fas fa-user text-3xl text-pink-600" id="defaultProfileIcon"></i>
                                <img id="profileImage" class="w-full h-full object-cover hidden" alt="Фото профиля">
                            </div>
                            <button type="button" id="changePhotoBtn" class="absolute bottom-0 right-0 bg-pink-600 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-pink-700 transition">
                                <i class="fas fa-camera text-sm"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label for="editFullName" class="block text-gray-700 font-medium mb-2">Имя</label>
                        <input type="text" id="editFullName" name="fullName" required 
                               class="form-input w-full" placeholder="Введите ваше имя">
                    </div>
                    
                    <div>
                        <label for="editPhone" class="block text-gray-700 font-medium mb-2">Телефон</label>
                        <input type="tel" id="editPhone" name="phone" 
                               class="form-input w-full" placeholder="+7 (___) ___-__-__">
                    </div>
                    
                    <div class="flex space-x-3 pt-4">
                        <button type="button" id="cancelEditBtn" 
                                class="flex-1 py-2 px-4 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                            Отмена
                        </button>
                        <button type="submit" class="flex-1 btn-primary py-2 px-4 rounded-lg text-white font-semibold">
                            Сохранить
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Photo Selection Modal -->
    <div id="photoSelectionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">Выберите фото профиля</h3>
                    <button id="closePhotoModalBtn" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label for="customPhotoUpload" class="block text-gray-700 font-medium mb-2">Загрузить свое фото</label>
                        <input type="file" id="customPhotoUpload" name="photo" accept="image/*" 
                               class="form-input w-full" onchange="handleCustomPhotoUpload(event)">
                        <p class="text-sm text-gray-500 mt-1">Поддерживаются форматы: JPG, PNG, WebP (макс. 5MB)</p>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-medium mb-3">Доступные изображения (аватары + иконки)</label>
                        <div id="standardPhotos" class="grid grid-cols-5 gap-3 max-h-80 overflow-y-auto p-2 bg-gray-50 rounded-lg">
                            <!-- Available images will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="flex space-x-3 pt-4">
                        <button type="button" id="cancelPhotoBtn" 
                                class="flex-1 py-2 px-4 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                            Отмена
                        </button>
                        <button type="button" id="savePhotoBtn" 
                                class="flex-1 py-2 px-4 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition">
                            Сохранить
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Supabase configuration
        let supabase;
        let currentUser = null;

        // Custom Notification System
        function showNotification(type, title, message, duration = 5000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            
            const icons = {
                success: 'fas fa-check',
                error: 'fas fa-exclamation-triangle',
                warning: 'fas fa-exclamation-circle',
                info: 'fas fa-info-circle'
            };
            
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="${icons[type]}"></i>
                </div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(notification);
            
            // Анимация появления
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Автоматическое удаление
            if (duration > 0) {
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }, duration);
            }
        }

        // Initialize Supabase
        async function initSupabase() {
            try {
                console.log('=== НАЧАЛО ИНИЦИАЛИЗАЦИИ SUPABASE ===');
                
                // Проверяем, что DOM загружен
                if (document.readyState !== 'complete') {
                    console.log('DOM еще не загружен, ждем...');
                    await new Promise(resolve => {
                        document.addEventListener('DOMContentLoaded', resolve);
                    });
                }
                
                // Проверяем, что Supabase SDK загружен
                console.log('Проверяем window.supabase:', typeof window.supabase);
                console.log('Проверяем глобальную переменную supabase:', typeof supabase);
                
                // Если SDK не найден, пробуем загрузить заново
                if (typeof window.supabase === 'undefined' && typeof supabase === 'undefined') {
                    console.log('SDK не найден, пробуем загрузить заново...');
                    await loadSupabase();
                    
                    // Проверяем снова
                    console.log('После повторной загрузки:');
                    console.log('- window.supabase:', typeof window.supabase);
                    console.log('- supabase:', typeof supabase);
                    
                    if (typeof window.supabase === 'undefined' && typeof supabase === 'undefined') {
                        throw new Error('Supabase SDK не загружен даже после повторной попытки');
                    }
                }
                
                // Используем доступный SDK
                const sdk = window.supabase || supabase;
                console.log('Используем SDK:', sdk);
                
                // Создаем клиент
                console.log('Создаем клиент Supabase...');
                const client = sdk.createClient(
                    'https://iaezefurqmmgubdgqakt.supabase.co',
                    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhZXplZnVycW1tZ3ViZGdxYWt0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU5NTk3NjQsImV4cCI6MjA3MTUzNTc2NH0.-Puoiddwu_xIx9BaHM0BBfbsULdU0Ljzh6uQleVToBQ'
                );
                
                console.log('Клиент создан:', client);
                
                // Присваиваем глобальным переменным
                window.supabaseClient = client;
                supabaseClient = client;
                
                console.log('Глобальные переменные установлены:');
                console.log('- window.supabaseClient:', window.supabaseClient);
                console.log('- supabaseClient:', supabaseClient);
                
                // Check if user is already logged in
                console.log('Проверяем текущего пользователя...');
                const { data: { user } } = await client.auth.getUser();
                if (user) {
                    console.log('Пользователь найден:', user);
                    currentUser = user;
                    showProfile();
                    loadUserProfile();
                    loadBookings();
                } else {
                    console.log('Пользователь не найден, показываем форму входа');
                    showAuth();
                }
                
                // Проверяем сессию в URL (для Magic Link)
                const { data: { session } } = await client.auth.getSession();
                if (session) {
                    console.log('Сессия найдена в URL:', session);
                    currentUser = session.user;
                    showProfile();
                    loadUserProfile();
                    loadBookings();
                }
                
                console.log('=== ИНИЦИАЛИЗАЦИЯ SUPABASE ЗАВЕРШЕНА УСПЕШНО ===');
                
                // Настраиваем форму входа
                console.log('Настраиваем форму входа...');
                setupLoginForm();
                
                // Настраиваем обработчик изменения состояния аутентификации
                console.log('Настраиваем обработчик аутентификации...');
                setupAuthStateChange();
                
            } catch (error) {
                console.error('=== ОШИБКА ИНИЦИАЛИЗАЦИИ SUPABASE ===');
                console.error('Error initializing Supabase:', error);
                console.error('Stack trace:', error.stack);
                showNotification('error', 'Ошибка инициализации', error.message);
            }
        }



        // Handle login form submission
        function setupLoginForm() {
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                console.log('Настраиваем форму входа...');
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    console.log('Форма отправлена!');
                    
                    const email = document.getElementById('email').value;
                    const loginBtn = document.getElementById('loginBtn');
                    const loginBtnText = document.getElementById('loginBtnText');
                    const loginBtnLoading = document.getElementById('loginBtnLoading');
                    
                    try {
                        // Проверяем, что Supabase инициализирован
                        const client = window.supabaseClient || supabaseClient;
                        if (!client || !client.auth) {
                            throw new Error('Supabase не инициализирован. Попробуйте обновить страницу.');
                        }
                        
                        console.log('Используем Supabase клиент:', client);
                        console.log('Email для входа:', email);
                        
                        // Show loading state
                        loginBtn.disabled = true;
                        loginBtnText.classList.add('hidden');
                        loginBtnLoading.classList.remove('hidden');
                        
                        // Send magic link
                        const { error } = await client.auth.signInWithOtp({
                            email: email,
                            options: {
                                emailRedirectTo: 'https://svetsalonpro.ru/pages/account.html'
                            }
                        });
                        
                        if (error) throw error;
                        
                        // Show success message
                        showNotification('success', 'Успешно!', 'Ссылка для входа отправлена на ваш email!');
                        
                    } catch (error) {
                        console.error('Login error:', error);
                        showNotification('error', 'Ошибка входа', error.message);
                    } finally {
                        // Reset button state
                        loginBtn.disabled = false;
                        loginBtnText.classList.remove('hidden');
                        loginBtnLoading.classList.add('hidden');
                    }
                });
                console.log('Форма входа настроена успешно!');
            } else {
                console.error('Форма входа не найдена!');
            }
        }

        // Handle logout
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                const client = window.supabaseClient || supabaseClient;
                await client.auth.signOut();
                currentUser = null;
                showAuth();
            } catch (error) {
                console.error('Logout error:', error);
            }
        });

        // Show auth section
        function showAuth() {
            try {
                const authSection = document.getElementById('authSection');
                const profileSection = document.getElementById('profileSection');
                
                if (!authSection || !profileSection) {
                    console.error('Не найдены секции auth или profile');
                    return;
                }
                
                authSection.classList.remove('hidden');
                profileSection.classList.add('hidden');
                console.log('Форма входа показана успешно');
            } catch (error) {
                console.error('Ошибка при показе формы входа:', error);
            }
        }

        // Show profile section
        function showProfile() {
            try {
                const authSection = document.getElementById('authSection');
                const profileSection = document.getElementById('profileSection');
                
                if (!authSection || !profileSection) {
                    console.error('Не найдены секции auth или profile');
                    return;
                }
                
                authSection.classList.add('hidden');
                profileSection.classList.remove('hidden');
                console.log('Профиль показан успешно');
            } catch (error) {
                console.error('Ошибка при показе профиля:', error);
            }
        }

        // Load user profile
        async function loadUserProfile() {
            if (!currentUser) {
                console.log('Нет текущего пользователя для загрузки профиля');
                return;
            }
            
            try {
                console.log('Загружаем профиль для пользователя:', currentUser.id);
                const client = window.supabaseClient || supabaseClient;
                
                if (!client) {
                    throw new Error('Supabase клиент не инициализирован');
                }
                
                const { data: profile, error } = await client
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (error && error.code !== 'PGRST116') {
                    throw error;
                }
                
                if (profile) {
                    console.log('Профиль найден:', profile);
                    document.getElementById('userName').textContent = profile.full_name || 'Пользователь';
                    document.getElementById('userEmail').textContent = profile.email || currentUser.email;
                    document.getElementById('userPhone').textContent = profile.phone || 'Не указан';
                } else {
                    console.log('Профиль не найден, создаем новый');
                    // Create profile if doesn't exist
                    await createUserProfile();
                }
                
                // Восстанавливаем выбранную аватарку
                restoreSelectedAvatar();
                
            } catch (error) {
                console.error('Error loading profile:', error);
                // Показываем базовую информацию пользователя
                document.getElementById('userName').textContent = currentUser.user_metadata?.full_name || 'Пользователь';
                document.getElementById('userEmail').textContent = currentUser.email || 'loading@email.com';
                document.getElementById('userPhone').textContent = 'Не указан';
                showNotification('warning', 'Внимание', 'Не удалось загрузить полный профиль, но вы можете продолжить работу');
                
                // Восстанавливаем выбранную аватарку даже при ошибке
                restoreSelectedAvatar();
            }
        }
        
        // Restore selected avatar from localStorage
        function restoreSelectedAvatar() {
            try {
                const savedAvatar = localStorage.getItem('selectedAvatar');
                if (!savedAvatar) return;
                
                console.log('Восстанавливаем аватарку:', savedAvatar);
                
                const profileImage = document.getElementById('profileImage');
                const defaultIcon = document.getElementById('defaultProfileIcon');
                
                if (!profileImage || !defaultIcon) return;
                
                if (savedAvatar.startsWith('icon-')) {
                    // Это иконка
                    profileImage.classList.add('hidden');
                    defaultIcon.classList.remove('hidden');
                    
                    const iconIndex = parseInt(savedAvatar.split('-')[1]);
                    const iconClasses = [
                        'fas fa-user', 'fas fa-user-tie', 'fas fa-user-graduate', 'fas fa-user-ninja',
                        'fas fa-user-astronaut', 'fas fa-user-cowboy', 'fas fa-user-doctor', 'fas fa-user-nurse',
                        'fas fa-user-secret', 'fas fa-user-tag', 'fas fa-user-check', 'fas fa-user-clock',
                        'fas fa-heart', 'fas fa-star', 'fas fa-crown', 'fas fa-gem', 'fas fa-sparkles',
                        'fas fa-fire', 'fas fa-leaf', 'fas fa-sun', 'fas fa-moon', 'fas fa-cloud',
                        'fas fa-flower', 'fas fa-butterfly'
                    ];
                    const iconColors = [
                        'text-pink-600', 'text-blue-600', 'text-green-600', 'text-purple-600',
                        'text-indigo-600', 'text-yellow-600', 'text-red-600', 'text-teal-600',
                        'text-gray-600', 'text-orange-600', 'text-emerald-600', 'text-cyan-600',
                        'text-rose-600', 'text-amber-600', 'text-yellow-600', 'text-violet-600',
                        'text-sky-600', 'text-orange-600', 'text-green-600', 'text-yellow-600',
                        'text-indigo-600', 'text-blue-600', 'text-pink-600', 'text-purple-600'
                    ];
                    
                    if (iconIndex < iconClasses.length) {
                        defaultIcon.className = `${iconClasses[iconIndex]} text-3xl ${iconColors[iconIndex]}`;
                    }
                    
                    // Обновляем основное фото профиля
                    const mainProfileImage = document.getElementById('mainProfileImage');
                    const mainProfileIcon = document.getElementById('mainProfileIcon');
                    
                    if (mainProfileImage) mainProfileImage.classList.add('hidden');
                    if (mainProfileIcon) {
                        mainProfileIcon.className = `${iconClasses[iconIndex]} text-3xl ${iconColors[iconIndex]}`;
                        mainProfileIcon.classList.remove('hidden');
                    }
                    
                } else {
                    // Это изображение (data URL или путь к файлу)
                    profileImage.src = savedAvatar;
                    profileImage.classList.remove('hidden');
                    defaultIcon.classList.add('hidden');
                    
                    // Обновляем основное фото профиля
                    const mainProfileImage = document.getElementById('mainProfileImage');
                    const mainProfileIcon = document.getElementById('mainProfileIcon');
                    
                    if (mainProfileImage) {
                        mainProfileImage.src = savedAvatar;
                        mainProfileImage.classList.remove('hidden');
                    }
                    if (mainProfileIcon) {
                        mainProfileIcon.classList.add('hidden');
                    }
                }
                
                console.log('Аватарка восстановлена успешно');
                
            } catch (error) {
                console.error('Error restoring avatar:', error);
            }
        }

        // Create user profile
        async function createUserProfile() {
            try {
                const client = window.supabaseClient || supabaseClient;
                const { error } = await client
                    .from('profiles')
                    .insert({
                        id: currentUser.id,
                        email: currentUser.email,
                        full_name: currentUser.user_metadata?.full_name || 'Пользователь',
                        created_at: new Date().toISOString()
                    });
                
                if (error) throw error;
                
                // Reload profile
                loadUserProfile();
            } catch (error) {
                console.error('Error creating profile:', error);
            }
        }

        // Load user bookings
        async function loadBookings() {
            if (!currentUser) {
                console.log('Нет текущего пользователя для загрузки записей');
                return;
            }
            
            try {
                console.log('Загружаем записи для пользователя:', currentUser.id);
                const client = window.supabaseClient || supabaseClient;
                
                if (!client) {
                    throw new Error('Supabase клиент не инициализирован');
                }
                
                const { data: bookings, error } = await client
                    .from('bookings')
                    .select(`
                        *,
                        services(name, price),
                        slots(date, time)
                    `)
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                console.log('Записи загружены:', bookings);
                displayBookings(bookings || []);
            } catch (error) {
                console.error('Error loading bookings:', error);
                // Показываем пустой список записей
                displayBookings([]);
                showNotification('warning', 'Внимание', 'Не удалось загрузить записи, но вы можете создать новые');
            }
        }

        // Display bookings
        function displayBookings(bookings) {
            const bookingsList = document.getElementById('bookingsList');
            const noBookings = document.getElementById('noBookings');
            
            if (bookings.length === 0) {
                bookingsList.classList.add('hidden');
                noBookings.classList.remove('hidden');
                return;
            }
            
            bookingsList.classList.remove('hidden');
            noBookings.classList.add('hidden');
            
            bookingsList.innerHTML = bookings.map(booking => `
                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-semibold text-gray-800">${booking.services?.name || 'Услуга'}</h4>
                            <p class="text-gray-600 text-sm">${new Date(booking.slots?.date).toLocaleDateString('ru-RU')} в ${booking.slots?.time}</p>
                            <p class="text-gray-500 text-sm">Статус: ${getStatusText(booking.status)}</p>
                        </div>
                        <div class="flex space-x-2">
                            ${booking.status === 'confirmed' ? `
                                <button onclick="cancelBooking('${booking.id}')" 
                                        class="px-3 py-1 text-sm border border-red-300 text-red-600 rounded hover:bg-red-50 transition">
                                    Отменить
                                </button>
                                <button onclick="rescheduleBooking('${booking.id}')" 
                                        class="px-3 py-1 text-sm border border-blue-300 text-blue-600 rounded hover:bg-blue-50 transition">
                                    Перенести
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Get status text
        function getStatusText(status) {
            const statuses = {
                'pending': 'Ожидает подтверждения',
                'confirmed': 'Подтверждено',
                'cancelled': 'Отменено',
                'completed': 'Завершено'
            };
            return statuses[status] || status;
        }

        // Cancel booking
        async function cancelBooking(bookingId) {
            if (!confirm('Вы уверены, что хотите отменить запись?')) return;
            
            try {
                const client = window.supabaseClient || supabaseClient;
                const { error } = await client
                    .from('bookings')
                    .update({ status: 'cancelled' })
                    .eq('id', bookingId);
                
                if (error) throw error;
                
                showNotification('success', 'Запись отменена', 'Ваша запись была успешно отменена');
                loadBookings();
            } catch (error) {
                console.error('Error cancelling booking:', error);
                showNotification('error', 'Ошибка', 'Не удалось отменить запись');
            }
        }

        // Reschedule booking
        function rescheduleBooking(bookingId) {
            showNotification('info', 'Информация', 'Функция переноса записи будет доступна в ближайшее время');
        }

        // Modal controls
        document.getElementById('newBookingBtn').addEventListener('click', () => {
            document.getElementById('bookingModal').classList.remove('hidden');
            // Показываем сетку услуг, скрываем форму
            document.querySelector('.grid').style.display = 'grid';
            document.getElementById('bookingFormContainer').classList.add('hidden');
        });

        document.getElementById('closeModalBtn').addEventListener('click', () => {
            // Убираем выделение со всех карточек
            document.querySelectorAll('.service-card').forEach(c => {
                c.classList.remove('selected');
            });
            
            // Сбрасываем форму и показываем сетку услуг
            document.querySelector('.grid').style.display = 'grid';
            document.getElementById('bookingFormContainer').classList.add('hidden');
            
            document.getElementById('bookingModal').classList.add('hidden');
        });


        
        // Back to Services Button
        document.getElementById('backToServicesBtn').addEventListener('click', () => {
            // Убираем выделение со всех карточек
            document.querySelectorAll('.service-card').forEach(c => {
                c.classList.remove('selected');
            });
            
            document.querySelector('.grid').style.display = 'grid';
            document.getElementById('bookingFormContainer').classList.add('hidden');
        });

        // Handle new booking form
        document.getElementById('newBookingForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const service = formData.get('service');
            const price = formData.get('price');
            const date = formData.get('date');
            const time = formData.get('time');
            
            try {
                const client = window.supabaseClient || supabaseClient;
                
                // Отправляем уведомление в Telegram
                const message = `💬 Новая запись через личный кабинет:\n👤 Пользователь: ${currentUser.email}\n📋 Услуга: ${service}\n💰 Цена: ${price} ₽\n📅 Дата: ${date}\n🕐 Время: ${time}`;
                
                const chatIds = ["339033504", "1366208620"]; // основной ID и ID Светланы
                
                chatIds.forEach(chatId => {
                    fetch("https://api.telegram.org/bot7811248285:AAHfspwV_mA-PF298Bac28LBkEeehX_ql70/sendMessage", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            chat_id: chatId,
                            text: message
                        })
                    }).then(response => {
                        if (response.ok) {
                            if (chatId === "339033504") {
                                showNotification('success', 'Запись отправлена!', 'Ожидайте подтверждения от администратора.');
                                document.getElementById('bookingModal').classList.add('hidden');
                                e.target.reset();
                                // Сбрасываем форму и показываем сетку услуг
                                document.querySelector('.grid').style.display = 'grid';
                                document.getElementById('bookingFormContainer').classList.add('hidden');
                            }
                        } else {
                            if (chatId === "339033504") {
                                showNotification('error', 'Ошибка отправки', 'Попробуйте позже');
                            }
                        }
                    }).catch(error => {
                        if (chatId === "339033504") {
                            showNotification('error', 'Ошибка соединения', 'Проверьте интернет');
                        }
                    });
                });
                
            } catch (error) {
                console.error('Error creating booking:', error);
                showNotification('error', 'Ошибка создания записи', error.message);
            }
        });

        // Initialize date and time inputs
        function initializeDateTimeInputs() {
            const dateInput = document.getElementById('dateSelect');
            const timeSelect = document.getElementById('timeSelect');
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            dateInput.min = today;
            
            // Generate time slots
            const timeSlots = [];
            for (let hour = 9; hour <= 20; hour++) {
                timeSlots.push(`${hour.toString().padStart(2, '0')}:00`);
                if (hour < 20) timeSlots.push(`${hour.toString().padStart(2, '0')}:30`);
            }
            
            timeSelect.innerHTML = '<option value="">Выберите время</option>' +
                timeSlots.map(time => `<option value="${time}">${time}</option>`).join('');
        }

        // Mobile menu functionality
        document.getElementById('mobileMenuBtn').addEventListener('click', () => {
            const mobileMenu = document.getElementById('mobileMenu');
            const icon = document.querySelector('#mobileMenuBtn i');
            
            if (mobileMenu.classList.contains('hidden')) {
                mobileMenu.classList.remove('hidden');
                icon.classList.remove('fa-bars');
                icon.classList.add('fa-times');
            } else {
                mobileMenu.classList.add('hidden');
                icon.classList.remove('fa-times');
                icon.classList.add('fa-bars');
            }
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', (e) => {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            
            if (!mobileMenu.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                mobileMenu.classList.add('hidden');
                const icon = document.querySelector('#mobileMenuBtn i');
                icon.classList.remove('fa-times');
                icon.classList.add('fa-bars');
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', async () => {
            await initSupabase();
            setupAuthStateChange();
            initializeDateTimeInputs();
            loadAvailableImages();
        });



        // Edit Profile Modal
        document.getElementById('editProfileBtn').addEventListener('click', () => {
            const modal = document.getElementById('editProfileModal');
            const fullNameInput = document.getElementById('editFullName');
            const phoneInput = document.getElementById('editPhone');
            
            // Fill current values
            fullNameInput.value = document.getElementById('userName').textContent;
            phoneInput.value = document.getElementById('userPhone').textContent === 'Не указан' ? '' : document.getElementById('userPhone').textContent;
            
            modal.classList.remove('hidden');
        });

        // Close Edit Profile Modal
        document.getElementById('closeEditModalBtn').addEventListener('click', () => {
            document.getElementById('editProfileModal').classList.add('hidden');
        });

        // Cancel Edit Profile
        document.getElementById('cancelEditBtn').addEventListener('click', () => {
            document.getElementById('editProfileModal').classList.add('hidden');
        });

        // Change Photo Button
        document.getElementById('changePhotoBtn').addEventListener('click', () => {
            document.getElementById('photoSelectionModal').classList.remove('hidden');
            loadStandardPhotos(); // Загружаем стандартные фото при открытии модального окна
        });

        // Close Photo Selection Modal
        document.getElementById('closePhotoModalBtn').addEventListener('click', () => {
            document.getElementById('photoSelectionModal').classList.add('hidden');
        });

        // Cancel Photo Selection
        document.getElementById('cancelPhotoBtn').addEventListener('click', () => {
            document.getElementById('photoSelectionModal').classList.add('hidden');
        });

        // Save Photo Selection
        document.getElementById('savePhotoBtn').addEventListener('click', () => {
            // Если выбрано фото, применяем его
            if (window.selectedPhotoPath) {
                applySelectedPhoto(window.selectedPhotoPath);
            }
            document.getElementById('photoSelectionModal').classList.add('hidden');
        });

        // Handle Edit Profile Form
        document.getElementById('editProfileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const fullName = document.getElementById('editFullName').value;
            const phone = document.getElementById('editPhone').value;
            
            // Сразу обновляем UI для быстрого отклика
            document.getElementById('userName').textContent = fullName;
            document.getElementById('userPhone').textContent = phone || 'Не указан';
            
            // Закрываем модальное окно
            document.getElementById('editProfileModal').classList.add('hidden');
            
            // Показываем уведомление об успехе
            showNotification('success', 'Профиль обновлен!', 'Ваши данные успешно сохранены');
            
            // Асинхронно сохраняем в базу данных
            setTimeout(async () => {
                try {
                    const client = window.supabaseClient || supabaseClient;
                    if (client) {
                        const { error } = await client
                            .from('profiles')
                            .update({
                                full_name: fullName,
                                phone: phone || null,
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', currentUser.id);
                        
                        if (error) {
                            console.error('Error saving to database:', error);
                            showNotification('warning', 'Внимание', 'Данные сохранены локально, но есть проблемы с сервером');
                        }
                    }
                } catch (error) {
                    console.error('Error saving to database:', error);
                    showNotification('warning', 'Внимание', 'Данные сохранены локально, но есть проблемы с сервером');
                }
            }, 100);
        });



        // Load Standard Photos and Icons
        async function loadStandardPhotos() {
            try {
                const container = document.getElementById('standardPhotos');
                if (!container) {
                    console.error('Container for standard photos not found');
                    return;
                }
                
                // Используем иконки из папки ICO
                const icoImages = [
                    '../images/ico/icon1.png',
                    '../images/ico/icon2.png',
                    '../images/ico/icon3.png',
                    '../images/ico/icon4.png',
                    '../images/ico/icon5.png',
                    '../images/ico/icon6.png',
                    '../images/ico/icon7.png',
                    '../images/ico/icon8.png',
                    '../images/ico/icon9.png',
                    '../images/ico/icon10.png',
                    '../images/ico/icon11.png',
                    '../images/ico/icon12.png',
                    '../images/ico/icon13.png',
                    '../images/ico/icon14.png',
                    '../images/ico/icon15.png',
                    '../images/ico/icon16.png',
                    '../images/ico/icon17.png',
                    '../images/ico/icon18.png',
                    '../images/ico/icon19.png',
                    '../images/ico/icon20.png',
                    '../images/ico/icon21.png',
                    '../images/ico/icon22.png',
                    '../images/ico/icon23.png',
                    '../images/ico/icon24.png',
                    '../images/ico/icon25.png',
                    '../images/ico/icon26.png',
                    '../images/ico/icon27.png',
                    '../images/ico/icon28.png',
                    '../images/ico/icon29.png',
                    '../images/ico/icon30.png'
                ];
                
                // Расширенный список красивых цветных иконок
                const colorIcons = [
                    { icon: 'fas fa-user', color: 'bg-gradient-to-br from-pink-400 to-pink-600' },
                    { icon: 'fas fa-user-tie', color: 'bg-gradient-to-br from-blue-400 to-blue-600' },
                    { icon: 'fas fa-user-graduate', color: 'bg-gradient-to-br from-green-400 to-green-600' },
                    { icon: 'fas fa-user-ninja', color: 'bg-gradient-to-br from-purple-400 to-purple-600' },
                    { icon: 'fas fa-user-astronaut', color: 'bg-gradient-to-br from-indigo-400 to-indigo-600' },
                    { icon: 'fas fa-user-cowboy', color: 'bg-gradient-to-br from-yellow-400 to-yellow-600' },
                    { icon: 'fas fa-user-doctor', color: 'bg-gradient-to-br from-red-400 to-red-600' },
                    { icon: 'fas fa-user-nurse', color: 'bg-gradient-to-br from-teal-400 to-teal-600' },
                    { icon: 'fas fa-user-secret', color: 'bg-gradient-to-br from-gray-400 to-gray-600' },
                    { icon: 'fas fa-user-tag', color: 'bg-gradient-to-br from-orange-400 to-orange-600' },
                    { icon: 'fas fa-user-check', color: 'bg-gradient-to-br from-emerald-400 to-emerald-600' },
                    { icon: 'fas fa-user-clock', color: 'bg-gradient-to-br from-cyan-400 to-cyan-600' },
                    { icon: 'fas fa-heart', color: 'bg-gradient-to-br from-rose-400 to-rose-600' },
                    { icon: 'fas fa-star', color: 'bg-gradient-to-br from-amber-400 to-amber-600' },
                    { icon: 'fas fa-crown', color: 'bg-gradient-to-br from-yellow-400 to-yellow-600' },
                    { icon: 'fas fa-gem', color: 'bg-gradient-to-br from-violet-400 to-violet-600' },
                    { icon: 'fas fa-sparkles', color: 'bg-gradient-to-br from-sky-400 to-sky-600' },
                    { icon: 'fas fa-fire', color: 'bg-gradient-to-br from-orange-400 to-orange-600' },
                    { icon: 'fas fa-leaf', color: 'bg-gradient-to-br from-green-400 to-green-600' },
                    { icon: 'fas fa-sun', color: 'bg-gradient-to-br from-yellow-400 to-yellow-600' },
                    { icon: 'fas fa-moon', color: 'bg-gradient-to-br from-indigo-400 to-indigo-600' },
                    { icon: 'fas fa-cloud', color: 'bg-gradient-to-br from-blue-400 to-blue-600' },
                    { icon: 'fas fa-flower', color: 'bg-gradient-to-br from-pink-400 to-pink-600' },
                    { icon: 'fas fa-butterfly', color: 'bg-gradient-to-br from-purple-400 to-purple-600' }
                ];
                
                let html = '';
                
                // Добавляем иконки из папки ICO с улучшенным дизайном
                icoImages.forEach((imagePath, index) => {
                    html += `
                        <div class="cursor-pointer group" onclick="selectStandardPhoto('${imagePath}', ${index})">
                            <div class="w-14 h-14 bg-gradient-to-br from-pink-100 to-pink-200 rounded-full flex items-center justify-center overflow-hidden border-2 border-pink-200 hover:border-pink-400 transition-all duration-300 transform hover:scale-110 shadow-md hover:shadow-lg">
                                <img src="${imagePath}" alt="Иконка ${index + 1}" class="w-full h-full object-cover" 
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'; this.parentElement.style.background='linear-gradient(135deg, #f3e8ff 0%, #fdf2f8 100%)';">
                                <i class="fas fa-user text-pink-600 text-xl" style="display: none;"></i>
                            </div>
                        </div>
                    `;
                });
                
                // Добавляем красивые цветные иконки
                colorIcons.forEach((iconData, index) => {
                    html += `
                        <div class="cursor-pointer group" onclick="selectStandardPhoto('icon-${index}', ${icoImages.length + index})">
                            <div class="w-14 h-14 ${iconData.color} rounded-full flex items-center justify-center border-2 border-white hover:border-pink-300 transition-all duration-300 transform hover:scale-110 shadow-md hover:shadow-lg">
                                <i class="${iconData.icon} text-white text-xl"></i>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                console.log('Standard photos loaded successfully');
                
            } catch (error) {
                console.error('Error loading standard photos:', error);
                showNotification('error', 'Ошибка загрузки', 'Не удалось загрузить доступные изображения');
            }
        }

        // Select Standard Photo
        function selectStandardPhoto(photoPath, index) {
            try {
                console.log('Selecting photo:', photoPath, index);
                
                // Сохраняем выбранное фото в глобальной переменной
                window.selectedPhotoPath = photoPath;
                
                // Убираем выделение со всех аватарок
                document.querySelectorAll('#standardPhotos > div').forEach(div => {
                    div.querySelector('div').classList.remove('ring-4', 'ring-pink-400', 'ring-offset-2');
                });
                
                // Добавляем выделение к выбранной аватарке
                const selectedDiv = document.querySelectorAll('#standardPhotos > div')[index];
                if (selectedDiv) {
                    selectedDiv.querySelector('div').classList.add('ring-4', 'ring-pink-400', 'ring-offset-2');
                }
                
                // Обновляем фото профиля
                const profileImage = document.getElementById('profileImage');
                const defaultIcon = document.getElementById('defaultProfileIcon');
                const profileImagePreview = document.getElementById('profileImagePreview');
                
                if (!profileImage || !defaultIcon || !profileImagePreview) {
                    throw new Error('Profile image elements not found');
                }
                
                // Проверяем, является ли это иконкой
                if (photoPath.startsWith('icon-')) {
                    // Это иконка - скрываем изображение и показываем иконку
                    profileImage.classList.add('hidden');
                    defaultIcon.classList.remove('hidden');
                    
                    // Обновляем иконку в основном профиле
                    const mainProfileImage = document.querySelector('#profileSection #profileImagePreview img');
                    const mainDefaultIcon = document.querySelector('#profileSection #profileImagePreview i');
                    
                    if (mainProfileImage) {
                        mainProfileImage.classList.add('hidden');
                    }
                    if (mainDefaultIcon) {
                        mainDefaultIcon.classList.remove('hidden');
                    }
                    
                    // Устанавливаем соответствующую иконку
                    const iconIndex = parseInt(photoPath.split('-')[1]);
                    const iconClasses = [
                        'fas fa-user', 'fas fa-user-tie', 'fas fa-user-graduate', 'fas fa-user-ninja',
                        'fas fa-user-astronaut', 'fas fa-user-cowboy', 'fas fa-user-doctor', 'fas fa-user-nurse',
                        'fas fa-user-secret', 'fas fa-user-tag', 'fas fa-user-check', 'fas fa-user-clock',
                        'fas fa-heart', 'fas fa-star', 'fas fa-crown', 'fas fa-gem', 'fas fa-sparkles',
                        'fas fa-fire', 'fas fa-leaf', 'fas fa-sun', 'fas fa-moon', 'fas fa-cloud',
                        'fas fa-flower', 'fas fa-butterfly'
                    ];
                    const iconColors = [
                        'text-pink-600', 'text-blue-600', 'text-green-600', 'text-purple-600',
                        'text-indigo-600', 'text-yellow-600', 'text-red-600', 'text-teal-600',
                        'text-gray-600', 'text-orange-600', 'text-emerald-600', 'text-cyan-600',
                        'text-rose-600', 'text-amber-600', 'text-yellow-600', 'text-violet-600',
                        'text-sky-600', 'text-orange-600', 'text-green-600', 'text-yellow-600',
                        'text-indigo-600', 'text-blue-600', 'text-pink-600', 'text-purple-600'
                    ];
                    
                    if (iconIndex < iconClasses.length) {
                        defaultIcon.className = `${iconClasses[iconIndex]} text-3xl ${iconColors[iconIndex]}`;
                        if (mainDefaultIcon) {
                            mainDefaultIcon.className = `${iconClasses[iconIndex]} text-3xl ${iconColors[iconIndex]}`;
                        }
                    }
                    
                    // Сохраняем выбор в localStorage
                    localStorage.setItem('selectedAvatar', photoPath);
                    
                } else {
                    // Это изображение
                    profileImage.src = photoPath;
                    profileImage.classList.remove('hidden');
                    defaultIcon.classList.add('hidden');
                    
                    // Обновляем основное фото профиля
                    const mainProfileImage = document.querySelector('#profileSection #profileImagePreview img');
                    if (mainProfileImage) {
                        mainProfileImage.src = photoPath;
                        mainProfileImage.classList.remove('hidden');
                    } else {
                        // Создаем изображение если его нет
                        const newImg = document.createElement('img');
                        newImg.src = photoPath;
                        newImg.alt = 'Фото профиля';
                        newImg.className = 'w-full h-full object-cover';
                        const container = document.querySelector('#profileSection #profileImagePreview');
                        if (container) {
                            container.appendChild(newImg);
                        }
                    }
                    
                    // Скрываем иконку по умолчанию в основном профиле
                    const mainDefaultIcon = document.querySelector('#profileSection #profileImagePreview i');
                    if (mainDefaultIcon) {
                        mainDefaultIcon.classList.add('hidden');
                    }
                    
                    // Сохраняем выбор в localStorage
                    localStorage.setItem('selectedAvatar', photoPath);
                }
                
                // Показываем уведомление об успешном выборе
                showNotification('success', 'Фото выбрано!', 'Нажмите "Сохранить" для применения изменений');
                
            } catch (error) {
                console.error('Error selecting standard photo:', error);
                showNotification('error', 'Ошибка', 'Не удалось выбрать изображение');
            }
        }

        // Apply Selected Photo
        function applySelectedPhoto(photoPath) {
            try {
                console.log('Applying selected photo:', photoPath);
                
                // Проверяем, является ли это иконкой
                if (photoPath.startsWith('icon-')) {
                    // Это иконка - применяем её
                    const iconIndex = parseInt(photoPath.split('-')[1]);
                    const iconClasses = [
                        'fas fa-user', 'fas fa-user-tie', 'fas fa-user-graduate', 'fas fa-user-ninja',
                        'fas fa-user-astronaut', 'fas fa-user-cowboy', 'fas fa-user-doctor', 'fas fa-user-nurse',
                        'fas fa-user-secret', 'fas fa-user-tag', 'fas fa-user-check', 'fas fa-user-clock',
                        'fas fa-heart', 'fas fa-star', 'fas fa-crown', 'fas fa-gem', 'fas fa-sparkles',
                        'fas fa-fire', 'fas fa-leaf', 'fas fa-sun', 'fas fa-moon', 'fas fa-cloud',
                        'fas fa-flower', 'fas fa-butterfly'
                    ];
                    const iconColors = [
                        'text-pink-600', 'text-blue-600', 'text-green-600', 'text-purple-600',
                        'text-indigo-600', 'text-yellow-600', 'text-red-600', 'text-teal-600',
                        'text-gray-600', 'text-orange-600', 'text-emerald-600', 'text-cyan-600',
                        'text-rose-600', 'text-amber-600', 'text-yellow-600', 'text-violet-600',
                        'text-sky-600', 'text-orange-600', 'text-green-600', 'text-yellow-600',
                        'text-indigo-600', 'text-blue-600', 'text-pink-600', 'text-purple-600'
                    ];
                    
                    if (iconIndex < iconClasses.length) {
                        // Обновляем иконку в модальном окне
                        const defaultIcon = document.getElementById('defaultProfileIcon');
                        const profileImage = document.getElementById('profileImage');
                        
                        if (defaultIcon) {
                            defaultIcon.className = `${iconClasses[iconIndex]} text-3xl ${iconColors[iconIndex]}`;
                            defaultIcon.classList.remove('hidden');
                        }
                        if (profileImage) {
                            profileImage.classList.add('hidden');
                        }
                        
                        // Обновляем иконку в основном профиле
                        const mainProfileIcon = document.getElementById('mainProfileIcon');
                        const mainProfileImage = document.getElementById('mainProfileImage');
                        
                        if (mainProfileIcon) {
                            mainProfileIcon.className = `${iconClasses[iconIndex]} text-3xl ${iconColors[iconIndex]}`;
                            mainProfileIcon.classList.remove('hidden');
                        }
                        if (mainProfileImage) {
                            mainProfileImage.classList.add('hidden');
                        }
                    }
                    
                } else {
                    // Это изображение - применяем его
                    const profileImage = document.getElementById('profileImage');
                    const defaultIcon = document.getElementById('defaultProfileIcon');
                    
                    if (profileImage) {
                        profileImage.src = photoPath;
                        profileImage.classList.remove('hidden');
                    }
                    if (defaultIcon) {
                        defaultIcon.classList.add('hidden');
                    }
                    
                    // Обновляем основное фото профиля
                    const mainProfileImage = document.getElementById('mainProfileImage');
                    const mainProfileIcon = document.getElementById('mainProfileIcon');
                    
                    if (mainProfileImage) {
                        mainProfileImage.src = photoPath;
                        mainProfileImage.classList.remove('hidden');
                    }
                    if (mainProfileIcon) {
                        mainProfileIcon.classList.add('hidden');
                    }
                }
                
                // Сохраняем в localStorage
                localStorage.setItem('selectedAvatar', photoPath);
                
                // Обновляем аватарку на главной странице через событие
                window.dispatchEvent(new CustomEvent('avatarUpdated', { detail: photoPath }));
                
                // Показываем уведомление об успехе
                showNotification('success', 'Фото применено!', 'Ваше фото профиля успешно обновлено');
                
            } catch (error) {
                console.error('Error applying selected photo:', error);
                showNotification('error', 'Ошибка', 'Не удалось применить выбранное фото');
            }
        }

        // Handle custom photo upload
        function handleCustomPhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Проверяем размер файла (5MB)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('error', 'Ошибка', 'Файл слишком большой. Максимальный размер: 5MB');
                event.target.value = '';
                return;
            }
            
            // Проверяем тип файла
            if (!file.type.startsWith('image/')) {
                showNotification('error', 'Ошибка', 'Пожалуйста, выберите изображение');
                event.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageData = e.target.result;
                
                // Обновляем фото профиля
                const profileImage = document.getElementById('profileImage');
                const defaultIcon = document.getElementById('defaultProfileIcon');
                
                if (profileImage && defaultIcon) {
                    profileImage.src = imageData;
                    profileImage.classList.remove('hidden');
                    defaultIcon.classList.add('hidden');
                    
                    // Обновляем основное фото профиля
                    const mainProfileImage = document.getElementById('mainProfileImage');
                    const mainProfileIcon = document.getElementById('mainProfileIcon');
                    
                    if (mainProfileImage) {
                        mainProfileImage.src = imageData;
                        mainProfileImage.classList.remove('hidden');
                    }
                    if (mainProfileIcon) {
                        mainProfileIcon.classList.add('hidden');
                    }
                    
                    // Сохраняем в localStorage
                    localStorage.setItem('selectedAvatar', imageData);
                    
                    // Обновляем аватарку на главной странице через событие
                    window.dispatchEvent(new CustomEvent('avatarUpdated', { detail: imageData }));
                    
                    showNotification('success', 'Фото загружено!', 'Ваше фото успешно загружено');
                }
            };
            
            reader.onerror = function() {
                showNotification('error', 'Ошибка', 'Не удалось загрузить изображение');
            };
            
            reader.readAsDataURL(file);
        }

        // Setup auth state change listener
        function setupAuthStateChange() {
            const client = window.supabaseClient || supabaseClient;
            if (client) {
                console.log('Настраиваем отслеживание состояния аутентификации...');
                client.auth.onAuthStateChange(async (event, session) => {
                    console.log('Auth state changed:', event, session);
                    if (event === 'SIGNED_IN' && session?.user) {
                        currentUser = session.user;
                        showProfile();
                        loadUserProfile();
                        loadBookings();
                    } else if (event === 'SIGNED_OUT') {
                        currentUser = null;
                        showAuth();
                    }
                });
            } else {
                console.error('Supabase клиент не найден для настройки auth state change');
            }
        }

        // Load saved avatar on page load
        function loadSavedAvatarOnPageLoad() {
            try {
                const savedAvatar = localStorage.getItem('selectedAvatar');
                if (savedAvatar) {
                    console.log('Loading saved avatar:', savedAvatar);
                    
                    // Элементы в модальном окне редактирования
                    const profileImage = document.getElementById('profileImage');
                    const defaultIcon = document.getElementById('defaultProfileIcon');
                    
                    // Элементы в основном профиле
                    const mainProfileImage = document.getElementById('mainProfileImage');
                    const mainProfileIcon = document.getElementById('mainProfileIcon');
                    
                    if (savedAvatar.startsWith('icon-')) {
                        // Это иконка
                        const iconIndex = parseInt(savedAvatar.split('-')[1]);
                        const iconClasses = [
                            'fas fa-user', 'fas fa-user-tie', 'fas fa-user-graduate', 'fas fa-user-ninja',
                            'fas fa-user-astronaut', 'fas fa-user-cowboy', 'fas fa-user-doctor', 'fas fa-user-nurse',
                            'fas fa-user-secret', 'fas fa-user-tag', 'fas fa-user-check', 'fas fa-user-clock',
                            'fas fa-heart', 'fas fa-star', 'fas fa-crown', 'fas fa-gem', 'fas fa-sparkles',
                            'fas fa-fire', 'fas fa-leaf', 'fas fa-sun', 'fas fa-moon', 'fas fa-cloud',
                            'fas fa-flower', 'fas fa-butterfly'
                        ];
                        const iconColors = [
                            'text-pink-600', 'text-blue-600', 'text-green-600', 'text-purple-600',
                            'text-indigo-600', 'text-yellow-600', 'text-red-600', 'text-teal-600',
                            'text-gray-600', 'text-orange-600', 'text-emerald-600', 'text-cyan-600',
                            'text-rose-600', 'text-amber-600', 'text-yellow-600', 'text-violet-600',
                            'text-sky-600', 'text-orange-600', 'text-green-600', 'text-yellow-600',
                            'text-indigo-600', 'text-blue-600', 'text-pink-600', 'text-purple-600'
                        ];
                        
                        if (iconIndex < iconClasses.length) {
                            // Обновляем иконку в модальном окне
                            if (defaultIcon) {
                                defaultIcon.className = `${iconClasses[iconIndex]} text-3xl ${iconColors[iconIndex]}`;
                                defaultIcon.classList.remove('hidden');
                            }
                            if (profileImage) {
                                profileImage.classList.add('hidden');
                            }
                            
                            // Обновляем иконку в основном профиле
                            if (mainProfileIcon) {
                                mainProfileIcon.className = `${iconClasses[iconIndex]} text-3xl ${iconColors[iconIndex]}`;
                                mainProfileIcon.classList.remove('hidden');
                            }
                            if (mainProfileImage) {
                                mainProfileImage.classList.add('hidden');
                            }
                        }
                    } else {
                        // Это изображение
                        // Обновляем изображение в модальном окне
                        if (profileImage) {
                            profileImage.src = savedAvatar;
                            profileImage.classList.remove('hidden');
                        }
                        if (defaultIcon) {
                            defaultIcon.classList.add('hidden');
                        }
                        
                        // Обновляем изображение в основном профиле
                        if (mainProfileImage) {
                            mainProfileImage.src = savedAvatar;
                            mainProfileImage.classList.remove('hidden');
                        }
                        if (mainProfileIcon) {
                            mainProfileIcon.classList.add('hidden');
                        }
                    }
                    
                    console.log('Avatar loaded successfully');
                }
            } catch (error) {
                console.error('Error loading saved avatar on page load:', error);
            }
        }

        // Initialize service card handlers when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved avatar
            loadSavedAvatarOnPageLoad();
            
            // Service Card Click Handlers
            document.querySelectorAll('.service-card').forEach(card => {
                card.addEventListener('click', () => {
                    // Убираем выделение со всех карточек
                    document.querySelectorAll('.service-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    // Добавляем выделение к выбранной карточке
                    card.classList.add('selected');
                    
                    const service = card.getAttribute('data-service');
                    const price = card.getAttribute('data-price');
                    const serviceName = card.querySelector('h4').textContent;
                    
                    // Заполняем скрытые поля
                    document.getElementById('selectedService').value = service;
                    document.getElementById('selectedServicePrice').value = price;
                    document.getElementById('selectedServiceName').textContent = serviceName;
                    
                    // Показываем уведомление о выборе
                    showNotification('success', 'Услуга выбрана!', `Выбрана услуга: ${serviceName}`);
                    
                    // Небольшая задержка перед показом формы для лучшего UX
                    setTimeout(() => {
                        // Скрываем сетку услуг, показываем форму
                        document.querySelector('.grid').style.display = 'none';
                        document.getElementById('bookingFormContainer').classList.remove('hidden');
                    }, 500);
                });
            });
        });

    </script>
</body>
</html>
